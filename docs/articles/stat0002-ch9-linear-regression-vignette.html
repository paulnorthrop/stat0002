<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chapter 9: Linear regression • stat0002</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 9: Linear regression">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stat0002</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stat0002-ch1a-shuttle-vignette.html">Chapter 1: The Challenger Space Shuttle Disaster</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch1b-stochastic-simulation-vignette.html">Chapter 1: Stochastic Simulation</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch1c-stochastic-simulation-vignette-2.html">Chapter 1: Stochastic Simulation 2</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch2a-descriptive-statistics-vignette.html">Chapter 2: Descriptive Statistics</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch2b-graphs-vignette.html">Chapter 2: Graphs (One Variable)</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch2c-graphs-vignette.html">Chapter 2: Graphs (More Than One Variable)</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch2d-box-cox-transformation-vignette.html">Chapter 2: Transformation Of Variable</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch3-probability-vignette.html">Chapter 3: Probability</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch4-more-probability-vignette.html">Chapter 4: More Probability</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch5-random-variables-vignette.html">Chapter 5: Random Variables</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch6a-discrete-random-variables-vignette.html">Chapter 6: binomial, geometric and Poisson distributions</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch6b-continous-random-variables-vignette.html">Chapter 6: uniform, exponential and normal distributions</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch6c-qq-plots-vignette.html">Chapter 6: QQ plots</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch7-statistical-inference-vignette.html">Chapter 7: Statistical Inference</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch8-contingency-tables-vignette.html">Chapter 8: Contingency tables</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch9-linear-regression-vignette.html">Chapter 9: Linear regression</a>
    </li>
    <li>
      <a href="../articles/stat0002-ch9plus1-correlation-vignette.html">Chapter 10: Correlation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/paulnorthrop/stat0002/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Chapter 9: Linear regression</h1>
                        <h4 data-toc-skip class="author">Paul
Northrop</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/stat0002/blob/HEAD/vignettes/stat0002-ch9-linear-regression-vignette.Rmd" class="external-link"><code>vignettes/stat0002-ch9-linear-regression-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>stat0002-ch9-linear-regression-vignette.Rmd</code></div>

    </div>

    
    
<p>This vignette provides some R code that is related to some of the
content of <a href="https://paulnorthrop.github.io/stat0002book/linreg.html#linreg" class="external-link">Chapter
9 of the STAT0002 notes</a>, namely to (simple) linear regression.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(stat0002)</span></code></pre></div>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>We use the Hubble data described at the start of <a href="https://paulnorthrop.github.io/stat0002book/linreg.html#simple-linear-regression" class="external-link">Section
9.1</a> of the notes. These data are available in the data frame
<code>hubble</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="sc">&gt;</span> hubble</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>   distance velocity</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">0.032</span>      <span class="dv">170</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="dv">2</span>     <span class="fl">0.034</span>      <span class="dv">290</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="dv">3</span>     <span class="fl">0.214</span>     <span class="sc">-</span><span class="dv">130</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="dv">4</span>     <span class="fl">0.263</span>      <span class="sc">-</span><span class="dv">70</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="dv">5</span>     <span class="fl">0.275</span>     <span class="sc">-</span><span class="dv">185</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="dv">6</span>     <span class="fl">0.275</span>     <span class="sc">-</span><span class="dv">220</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="dv">7</span>     <span class="fl">0.450</span>      <span class="dv">200</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="dv">8</span>     <span class="fl">0.500</span>      <span class="dv">290</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="dv">9</span>     <span class="fl">0.500</span>      <span class="dv">270</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="dv">10</span>    <span class="fl">0.630</span>      <span class="dv">200</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="dv">11</span>    <span class="fl">0.800</span>      <span class="dv">300</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="dv">12</span>    <span class="fl">0.900</span>      <span class="sc">-</span><span class="dv">30</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="dv">13</span>    <span class="fl">0.900</span>      <span class="dv">650</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="dv">14</span>    <span class="fl">0.900</span>      <span class="dv">150</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="dv">15</span>    <span class="fl">0.900</span>      <span class="dv">500</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="dv">16</span>    <span class="fl">1.000</span>      <span class="dv">920</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="dv">17</span>    <span class="fl">1.100</span>      <span class="dv">450</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="dv">18</span>    <span class="fl">1.100</span>      <span class="dv">500</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="dv">19</span>    <span class="fl">1.400</span>      <span class="dv">500</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="dv">20</span>    <span class="fl">1.700</span>      <span class="dv">960</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="dv">21</span>    <span class="fl">2.000</span>      <span class="dv">500</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="dv">22</span>    <span class="fl">2.000</span>      <span class="dv">850</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="dv">23</span>    <span class="fl">2.000</span>      <span class="dv">800</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="dv">24</span>    <span class="fl">2.000</span>     <span class="dv">1090</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(<span class="fu">rev</span>(hubble), <span class="at">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="stat0002-ch9-linear-regression-vignette_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="the-r-function-lm">The R function <code>lm</code><a class="anchor" aria-label="anchor" href="#the-r-function-lm"></a>
</h2>
<p>R provides a function <code>lm</code> to fit linear regression
models. The following code fits a simple linear regression model to the
<code>hubble</code> data, with <code>distance</code> as the response
variable and <code>velocity</code> as the one explanatory variable. The
<code>lm</code> function can do much more than this For example, it can
fit a regression model that has more one explanatory variable.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="sc">&gt;</span> l3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(distance <span class="sc">~</span> velocity, <span class="at">data =</span> hubble)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="sc">&gt;</span> l3 </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> distance <span class="sc">~</span> velocity, <span class="at">data =</span> hubble)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>(Intercept)     velocity  </span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>   <span class="fl">0.399098</span>     <span class="fl">0.001373</span>  </span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">coef</span>(l3)</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>(Intercept)    velocity </span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="fl">0.399098216</span> <span class="fl">0.001372936</span> </span></code></pre></div>
<p>The point estimates of the intercept
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and gradient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
regression parameters agree with those in the title of Figure 9.6 of the
notes. Note that <code>coef</code> is a generic function that (tries to)
extracts parameter estimates from a fitted model object.</p>
</div>
<div class="section level2">
<h2 id="our-own-function-slm">Our own function <code>slm</code><a class="anchor" aria-label="anchor" href="#our-own-function-slm"></a>
</h2>
<p>As an exercise in writing an R function and to demonstrate that the
expressions for the least squares estimators
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>α</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\alpha}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>β</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\beta}</annotation></semantics></math>
given in <a href="https://paulnorthrop.github.io/stat0002book/linreg.html#least-squares-estimation-of-alpha-and-beta" class="external-link">Section
9.1.2</a> are correct, we write our own function <code>slm</code> to
perform simple linear regression. We give our returned (list) object the
class <code>"lm"</code>, including the <code>call</code> (the code that
calls the function <code>slm</code>) and the <code>coefficients</code>
(estimated of the regression parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>)
so that when we print our results they looks like those from
<code>lm</code>. We also include other useful quantities, with names
that should indicate what they contain.</p>
<p>We include an argument <code>rto</code>, which stands for “regression
through the origin”. For these data, Hubble’s Law gives us a reason to
consider a special linear regression model in which the fitted line is
forced to go through the origin, that is, the intercept parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
is set to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
rather than being estimated from the data. We also deal with the
situation where no explanatory data are provided. For further
information see <a href="https://paulnorthrop.github.io/stat0002book/linreg.html#least-squares-fitting-to-hubbles-data" class="external-link">Section
9.1.3</a> of the notes.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="sc">&gt;</span> slm <span class="ot">&lt;-</span> <span class="cf">function</span>(y, x, <span class="at">rto =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># If only response data are provided then fit a horizontal line y = mean(y)</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="sc">+</span>   <span class="cf">if</span> (<span class="fu">missing</span>(x)) {</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="sc">+</span>     residuals <span class="ot">&lt;-</span> y <span class="sc">-</span> <span class="fu">mean</span>(y)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="sc">+</span>     rss <span class="ot">&lt;-</span> <span class="fu">sum</span>(residuals <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="sc">+</span>     n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="sc">+</span>     estimates <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">names</span>(estimates) <span class="ot">&lt;-</span> <span class="st">"(Intercept)"</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="sc">+</span>     res <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">coefficients =</span> estimates, <span class="at">fitted.values =</span> <span class="fu">mean</span>(y),</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">residuals =</span> y <span class="sc">-</span> <span class="fu">mean</span>(y), <span class="at">rss =</span> rss, </span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">sigmahat =</span> <span class="fu">sqrt</span>(rss <span class="sc">/</span> (n <span class="sc">-</span> <span class="dv">1</span>)), <span class="at">y =</span> y, <span class="at">call =</span> <span class="fu">match.call</span>())</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">class</span>(res) <span class="ot">&lt;-</span> <span class="st">"lm"</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">return</span>(res)</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="sc">+</span>   }</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># Check that y and x have the same length  </span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="sc">+</span>   <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">!=</span> <span class="fu">length</span>(x)) {</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">stop</span>(<span class="st">"''y'' and ''x'' must have the same length"</span>)</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="sc">+</span>   }</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># Calculate the estimates.  If rto = FALSE (the default) then we estimate </span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># both alpha and beta from the data.  If rto = TRUE then we set alpha = 0</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># and estimate only beta from the data.</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="sc">+</span>   ybar <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="sc">+</span>   <span class="cf">if</span> (rto) {</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="sc">+</span>     betahat <span class="ot">&lt;-</span> <span class="fu">mean</span>(x <span class="sc">*</span> y) <span class="sc">/</span> <span class="fu">mean</span>(x <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="sc">+</span>     alphahat <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="sc">+</span>     estimates <span class="ot">&lt;-</span> betahat</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">names</span>(estimates) <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(x))</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="sc">+</span>   } <span class="cf">else</span> {</span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="sc">+</span>     xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="sc">+</span>     betahat <span class="ot">&lt;-</span> <span class="fu">mean</span>((x <span class="sc">-</span> xbar) <span class="sc">*</span> (y <span class="sc">-</span> ybar)) <span class="sc">/</span> <span class="fu">mean</span>((x <span class="sc">-</span> xbar) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="sc">+</span>     alphahat <span class="ot">&lt;-</span> ybar <span class="sc">-</span> betahat <span class="sc">*</span> xbar</span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="sc">+</span>     estimates <span class="ot">&lt;-</span> <span class="fu">c</span>(alphahat, betahat)</span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">names</span>(estimates) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="fu">deparse</span>(<span class="fu">substitute</span>(x)))</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a><span class="sc">+</span>   }</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># Calculate the fitted values for y, residuals and residual sum of squares</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a><span class="sc">+</span>   fittedy <span class="ot">&lt;-</span> alphahat <span class="sc">+</span> betahat <span class="sc">*</span> x</span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a><span class="sc">+</span>   residuals <span class="ot">&lt;-</span> y <span class="sc">-</span> fittedy</span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a><span class="sc">+</span>   rss <span class="ot">&lt;-</span> <span class="fu">sum</span>(residuals <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># Estimate of the error standard deviation sigma</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a><span class="sc">+</span>   n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a><span class="sc">+</span>   p <span class="ot">&lt;-</span> <span class="fu">length</span>(estimates)</span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a><span class="sc">+</span>   sigmahat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(rss <span class="sc">/</span> (n <span class="sc">-</span> p))</span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># Create the results list </span></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a><span class="sc">+</span>   res <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">coefficients =</span> estimates, <span class="at">fitted.values =</span> fittedy, </span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a><span class="sc">+</span>               <span class="at">residuals =</span> residuals, <span class="at">rss =</span> rss, <span class="at">sigmahat =</span> sigmahat,</span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a><span class="sc">+</span>               <span class="at">y =</span> y, <span class="at">x =</span> x, <span class="at">call =</span> <span class="fu">match.call</span>())  </span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">class</span>(res) <span class="ot">&lt;-</span> <span class="st">"lm"</span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">return</span>(res)</span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a><span class="sc">+</span> }</span></code></pre></div>
<p>The following code fits Model 3 from <a href="https://paulnorthrop.github.io/stat0002book/linreg.html#least-squares-fitting-to-hubbles-data" class="external-link">Section
9.1.3</a>, plots the data again and adds the fitted regression line.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Model 3</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="er">&gt;</span> m3 <span class="ot">&lt;-</span> <span class="fu">slm</span>(<span class="at">y =</span> hubble<span class="sc">$</span>distance, <span class="at">x =</span> hubble<span class="sc">$</span>velocity)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="sc">&gt;</span> m3</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="fu">slm</span>(<span class="at">y =</span> hubble<span class="sc">$</span>distance, <span class="at">x =</span> hubble<span class="sc">$</span>velocity)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    (Intercept)  hubble<span class="sc">$</span>velocity  </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>       <span class="fl">0.399098</span>         <span class="fl">0.001373</span>  </span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(<span class="fu">rev</span>(hubble), <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">abline</span>(<span class="at">coef =</span> <span class="fu">coef</span>(m3))</span></code></pre></div>
<p><img src="stat0002-ch9-linear-regression-vignette_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
<p>For the sake of completeness we also fit Models 1 and 2 from <a href="https://paulnorthrop.github.io/stat0002book/linreg.html#least-squares-fitting-to-hubbles-data" class="external-link">Section
9.1.3</a>, which assume, respectively, that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\beta=0</annotation></semantics></math>
and that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha = 0</annotation></semantics></math>,
and show that our results agree with those from <code>lm</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Model 1</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># ~1 means that there is no explanatory variable in the model</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="er">&gt;</span> m1 <span class="ot">&lt;-</span> <span class="fu">slm</span>(<span class="at">y =</span> hubble<span class="sc">$</span>distance)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="sc">&gt;</span> l1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(distance <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> hubble)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">coef</span>(m1)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>(Intercept) </span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>   <span class="fl">0.911375</span> </span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">coef</span>(l1)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>(Intercept) </span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>   <span class="fl">0.911375</span> </span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># Model 2</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># The -1 removes the intercept from the model</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="er">&gt;</span> m2 <span class="ot">&lt;-</span> <span class="fu">slm</span>(<span class="at">y =</span> hubble<span class="sc">$</span>distance, <span class="at">x =</span> hubble<span class="sc">$</span>velocity, <span class="at">rto =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="sc">&gt;</span> l2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(distance <span class="sc">~</span> velocity <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> hubble)</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">coef</span>(m2)</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>hubble<span class="sc">$</span>velocity </span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>    <span class="fl">0.001921806</span> </span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">coef</span>(l2)</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>   velocity </span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="fl">0.001921806</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimating-the-error-standard-deviation">Estimating the error standard deviation<a class="anchor" aria-label="anchor" href="#estimating-the-error-standard-deviation"></a>
</h2>
<p>An unbiased estimator of the error variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>σ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>
is the sum of the squared residuals divided by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">n - p</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
is the sample size and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is the number of parameter estimated. See <a href="https://paulnorthrop.github.io/stat0002book/linreg.html#least-squares-estimation-of-alpha-and-beta" class="external-link">Section
9.1.2</a>, which considers the case where both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
are estimated. In the following, <code>sigma</code> is a function that
(tries to) calculate an estimate of the standard deviation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
of the errors. It does this, as is commonly the case, by taking by
square root of the estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>σ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>.
Again, our function agrees with the output from <code>lm</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="sc">&gt;</span> m3<span class="sc">$</span>sigmahat</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.4049588</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sigma</span>(m3)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.4049588</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sigma</span>(l3)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.4049588</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="standardised-residuals">Standardised residuals<a class="anchor" aria-label="anchor" href="#standardised-residuals"></a>
</h2>
<p>In <a href="https://paulnorthrop.github.io/stat0002book/linreg.html#model-checking" class="external-link">Section
9.3</a> of the notes we define the <strong>standardised
residuals</strong> for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
observation in the data by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>r</mi><mi>i</mi><mi>S</mi></msubsup><mo>=</mo><mfrac><msub><mi>r</mi><mi>i</mi></msub><mrow><mover><mi>σ</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>h</mi><mrow><mi>i</mi><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">r_i^S = \frac{r_i}{\hat{\sigma}(1-h_{ii})},</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mi>i</mi></msub><annotation encoding="application/x-tex">r_i</annotation></semantics></math>
is the residual for observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>σ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\sigma}</annotation></semantics></math>
is the estimate of the error standard deviation and
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>i</mi><mi>i</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><mo>+</mo><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">h_{ii} = \frac1n + \frac{(x_i - \bar{x}) ^ 2}{\sum_{i=1}^n (x_i - \bar{x}) ^ 2}.</annotation></semantics></math>
is the <strong>leverage</strong> of observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.
If the model is correct then these residuals have approximately a
variance of 1. If the errors are normally distributed then these
residuals should look like a sample from a standard normal distribution.
We write a function to calculate these standardised residuals for a
model fit produced by <code>slm</code> and use this function in the next
section to produce a normal QQ plot of standardised residuals.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="sc">&gt;</span> stres <span class="ot">&lt;-</span> <span class="cf">function</span>(slmfit) {</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># The generic function nobs tries to calculate the number of observations</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="sc">+</span>   n <span class="ot">&lt;-</span> <span class="fu">nobs</span>(slmfit)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># Extract the values of the explanatory variables</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="sc">+</span>   x <span class="ot">&lt;-</span> slmfit<span class="sc">$</span>x</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="sc">+</span>   <span class="co"># Calculate the leverage value for each observation</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="sc">+</span>   sx2 <span class="ot">&lt;-</span> (x <span class="sc">-</span> <span class="fu">mean</span>(x)) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="sc">+</span>   hii <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> n <span class="sc">+</span> sx2 <span class="sc">/</span> <span class="fu">sum</span>(sx2)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">return</span>(slmfit<span class="sc">$</span>residuals <span class="sc">/</span> (slmfit<span class="sc">$</span>sigmahat <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> hii <span class="sc">^</span> <span class="dv">2</span>)))</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="sc">+</span> }</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="residual-plots">Residual plots<a class="anchor" aria-label="anchor" href="#residual-plots"></a>
</h2>
<p>We plot the residuals against the values of the explanatory variable,
velocity, and then against the fitted values. When there is only one
explanatory variable these plots will look identical, apart from a
change of scale on the horizontal axis. This is because each fitted
values is a linear function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>α</mi><mo accent="true">̂</mo></mover><mo>+</mo><mover><mi>β</mi><mo accent="true">̂</mo></mover><mi>x</mi></mrow><annotation encoding="application/x-tex">\hat{\alpha} + \hat{\beta} x</annotation></semantics></math>,
of the corresponding value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
of the explanatory variable.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(m3<span class="sc">$</span>x, m3<span class="sc">$</span>residual, <span class="at">ylab =</span> <span class="st">"residual"</span>, <span class="at">xlab =</span> <span class="st">"velocity"</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="stat0002-ch9-linear-regression-vignette_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(m3<span class="sc">$</span>fitted.values, m3<span class="sc">$</span>residual, <span class="at">ylab =</span> <span class="st">"residual"</span>, <span class="at">xlab =</span> <span class="st">"fitted values"</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="stat0002-ch9-linear-regression-vignette_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Now, we produce a normal QQ plot of the standardised residuals and
check that we is correct using the built-in <code>plot</code> function
for <code>lm</code> objects, selecting <code>which = 2</code> to ask for
a normal QQ plot.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="sc">&gt;</span> stresiduals <span class="ot">&lt;-</span> <span class="fu">stres</span>(m3)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">qqnorm</span>(stresiduals, <span class="at">ylab =</span> <span class="st">"Standardised Residuals"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">qqline</span>(stresiduals)</span></code></pre></div>
<p><img src="stat0002-ch9-linear-regression-vignette_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># By default, the 3 residuals with the largest magnitudes are labelled by their observation number</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">plot</span>(l3, <span class="at">which =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="stat0002-ch9-linear-regression-vignette_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;"></p>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Paul J. Northrop.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
