<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 1: Stochastic Simulation • stat0002</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 1: Stochastic Simulation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stat0002</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/stat0002-ch1a-shuttle-vignette.html">Chapter 1: The Challenger Space Shuttle Disaster</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch1b-stochastic-simulation-vignette.html">Chapter 1: Stochastic Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch1c-stochastic-simulation-vignette-2.html">Chapter 1: Stochastic Simulation 2</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch2a-descriptive-statistics-vignette.html">Chapter 2: Descriptive Statistics</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch2b-graphs-vignette.html">Chapter 2: Graphs (One Variable)</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch2c-graphs-vignette.html">Chapter 2: Graphs (More Than One Variable)</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch2d-box-cox-transformation-vignette.html">Chapter 2: Transformation Of Variable</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch3-probability-vignette.html">Chapter 3: Probability</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch4-more-probability-vignette.html">Chapter 4: More Probability</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch5-random-variables-vignette.html">Chapter 5: Random Variables</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch6a-discrete-random-variables-vignette.html">Chapter 6: binomial, geometric and Poisson distributions</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch6b-continous-random-variables-vignette.html">Chapter 6: uniform, exponential and normal distributions</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch6c-qq-plots-vignette.html">Chapter 6: QQ plots</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch7-statistical-inference-vignette.html">Chapter 7: Statistical Inference</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch8-contingency-tables-vignette.html">Chapter 8: Contingency tables</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch9-linear-regression-vignette.html">Chapter 9: Linear regression</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-ch9plus1-correlation-vignette.html">Chapter 10: Correlation</a></li>
    <li><a class="dropdown-item" href="../articles/stat0002-creating-pdf-files-vignette.html">Creating PDF files using R markdown</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/paulnorthrop/stat0002/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 1: Stochastic Simulation</h1>
                        <h4 data-toc-skip class="author">Paul
Northrop</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/stat0002/blob/HEAD/vignettes/stat0002-ch1b-stochastic-simulation-vignette.Rmd"><code>vignettes/stat0002-ch1b-stochastic-simulation-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>stat0002-ch1b-stochastic-simulation-vignette.Rmd</code></div>
    </div>

    
    
<p>Stochastic simulation uses computer-generated <em>pseudo-random
numbers</em> to mimic a stochastic real event or dataset. Pseudo-random
numbers are not random (they are produced by an algorithm) but the
algorithm is constructed in order to imitate randomness closely enough.
A typical use of stochastic simulation is to generate numbers that
behave approximately like a random sample from an particular probability
distribution.</p>
<p>In this vignette we concentrate on using R to perform stochastic
simulation. If you want to know more then good sources of information
are <span class="citation">Morgan (1984)</span> and <span class="citation">Jasra (2011)</span>.</p>
<p>The function <code>rbinomial</code> can be viewed by typing
<code>rbinomial</code> at R command prompt <code>&gt;</code>.</p>
<div class="section level2">
<h2 id="pseudo-random-numbers-in-01">Pseudo-random numbers in (0,1)<a class="anchor" aria-label="anchor" href="#pseudo-random-numbers-in-01"></a>
</h2>
<p>The basic building block of stochastic simulation methods is the
ability to simulate numbers (pseudo-) randomly from the interval (0,1).
As we will see in Chapter 5 of the STAT0002 notes this is equivalent to
generating numbers that behave approximately like a random sample from a
standard uniform U(0,1) distribution. The function in R that does this
is <code>runif</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(stat0002)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">runif</span>(<span class="dv">10</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a> [<span class="dv">1</span>] <span class="fl">0.2716465</span> <span class="fl">0.2459657</span> <span class="fl">0.7786462</span> <span class="fl">0.9790115</span> <span class="fl">0.4347586</span> <span class="fl">0.9141322</span> <span class="fl">0.4885213</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a> [<span class="dv">8</span>] <span class="fl">0.3757858</span> <span class="fl">0.5054086</span> <span class="fl">0.4264149</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation-from-a-binomial-distribution">Simulation from a binomial distribution<a class="anchor" aria-label="anchor" href="#simulation-from-a-binomial-distribution"></a>
</h2>
<p>In the <a href="stat0002-ch1a-shuttle-vignette.html">Challenger Space
Shuttle disaster</a> vignette we needed to simulate numbers from a
binomial distribution with parameters <span class="math inline">\(6\)</span> and <span class="math inline">\(p\)</span>, for a given value of <span class="math inline">\(p\)</span>. As we will see in Chapter 5 of the
STAT0002 notes this distribution arises as the number of ‘successes’
(perversely, in the space shuttle example thermal distress of an O-ring
is a ‘success’) in a fixed number (here, this is 6) of independent
trials, where each trial results either in a ‘success’ or a
‘failure’.</p>
<p>Suppose that <span class="math inline">\(p=0.2\)</span>, which is the
approximate estimated probability (under a linear logistic model) that
an O-ring suffers thermal distress when the space shuttle is launched at
58 degrees Fahrenheit.</p>
<p>The function in R that simulates from a binomial distribution is
<code>rbinom</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">prob =</span> <span class="fl">0.2</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">0</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><strong>Can you see the convention in the way that R’s simulation
functions are named?</strong></li>
</ol>
<p>Underlying <code>rbinom</code> is an algorithm that works quickly
even in cases where the number of trials (<code>size</code>) is large.
With a small number of trials, like 6, we could work more directly,
using numbers produced by <code>runif</code> to assign the result of
each trial to ‘success’ or ‘failure’. This is like tossing a coin that
is biased so that ‘heads’ is obtained with probability 0.2. The function
<code>rbinomial</code> below simulates <em>one</em> value from a
binomial distribution with parameters <code>size</code> and
<code>prob</code>. Use <code><a href="../reference/rbinomial.html">?rbinomial</a></code> to view the help file.
This function is less general and less efficient than
<code>rbinom</code>. However, it is useful to illustrate a simple way to
simulate from a binomial distribution and as an example of how we can
write our own R functions to perform calculations.</p>
<pre><code><span><span class="va">rbinomial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">size</span>, <span class="va">prob</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Simulate size values (pseudo-)randomly between 0 and 1.</span></span>
<span>  <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span></span>
<span>  <span class="co"># Find out whether (TRUE) or not (FALSE) each value of u is less than prob.</span></span>
<span>  <span class="va">distress</span> <span class="op">&lt;-</span> <span class="va">u</span> <span class="op">&lt;</span> <span class="va">prob</span></span>
<span>  <span class="co"># Count the number of TRUEs, i.e. the number of successes.</span></span>
<span>  <span class="va">n_successes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">distress</span><span class="op">)</span></span>
<span>  <span class="co"># Return the number of successes.</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">n_successes</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
<p>We simulate one value from a binomial(6, 0.2) distribution. [We use
<code>set.seed</code> to initialize the pseudo-random number sequence in
a particular place. This will enable us to repeat these calculations
below using exactly the same random numbers.]</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">set.seed</span>(<span class="dv">1826</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rbinomial</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">prob =</span> <span class="fl">0.2</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Can you work out what is happening in each line of the code
inside <code>rbinomial</code>? The following should help.</strong></li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">set.seed</span>(<span class="dv">1826</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="sc">&gt;</span> size <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="sc">&gt;</span> prob <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="sc">&gt;</span> u <span class="ot">&lt;-</span> <span class="fu">runif</span>(size)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="sc">&gt;</span> u</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.3561567</span> <span class="fl">0.9131876</span> <span class="fl">0.5627795</span> <span class="fl">0.1879185</span> <span class="fl">0.3193222</span> <span class="fl">0.6738423</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="sc">&gt;</span> distress <span class="ot">&lt;-</span> u <span class="sc">&lt;</span> prob</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="sc">&gt;</span> distress</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span> <span class="cn">FALSE</span> <span class="cn">FALSE</span>  <span class="cn">TRUE</span> <span class="cn">FALSE</span> <span class="cn">FALSE</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="sc">&gt;</span> n_successes <span class="ot">&lt;-</span> <span class="fu">sum</span>(distress)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="sc">&gt;</span> n_successes</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><strong>The effect of <code>sum(distress)</code> is quite subtle.
Can you see what is happening? Check your answer using
<code><a href="https://rdrr.io/r/base/sum.html" class="external-link">?sum</a></code>.</strong></li>
</ol>
<p>A related point is that if we turn the logical vector
<code>distress</code> (which contains <code>TRUE</code>s and
<code>FALSE</code>s) into a numeric vector, then we get …</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">as.numeric</span>(distress)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation-from-a-exponential-distribution">Simulation from a exponential distribution<a class="anchor" aria-label="anchor" href="#simulation-from-a-exponential-distribution"></a>
</h2>
<p>The exponential distribution is an example of a probability
distribution of a continuous random variable.</p>
<ol start="4" style="list-style-type: decimal">
<li><strong>Can you guess the name of the R function for simulating from
an exponential distribution?</strong></li>
</ol>
<p>We simulate a sample of size 1000 from an exponential distribution
with (rate) parameter equal to 2.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="sc">&gt;</span> lambda <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="sc">&gt;</span> exp_sim <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">rate =</span> lambda)</span></code></pre></div>
<p>We produce a histogram of these simulated values and superimpose the
probability density function (p.d.f.) of the exponential distribution
from which these values have been simulated.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># A histogram (see Section 2.5 of the STAT0002 notes)</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">hist</span>(exp_sim, <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, lambda), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(exp_sim), <span class="at">len =</span> <span class="dv">500</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lines</span>(x, <span class="fu">dexp</span>(x, <span class="at">rate =</span> lambda))</span></code></pre></div>
<p><img src="stat0002-ch1b-stochastic-simulation-vignette_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<ol start="5" style="list-style-type: decimal">
<li><strong>Can you guess what the function <code>dexp</code> does? Use
<code><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">?dexp</a></code> to find out.</strong></li>
</ol>
<p>The following R code could also be used to simulate from an
exponential distribution.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="sc">&gt;</span> u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1000</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="sc">&gt;</span> exp_inv <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(u)<span class="sc">/</span>lambda</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">hist</span>(exp_inv, <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, lambda), <span class="at">main =</span> <span class="st">""</span>, <span class="at">breaks =</span> <span class="dv">14</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lines</span>(x, <span class="fu">dexp</span>(x, <span class="at">rate =</span> lambda))</span></code></pre></div>
<p><img src="stat0002-ch1b-stochastic-simulation-vignette_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="the-inversion-method">The inversion method<a class="anchor" aria-label="anchor" href="#the-inversion-method"></a>
</h2>
<p>The code immediately above is an example of the <em>inversion
method</em> of simulation. The following code implements this for the
normal distribution.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="sc">&gt;</span> u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1000</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="sc">&gt;</span> mu <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="sc">&gt;</span> sigma <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="sc">&gt;</span> norm_sim <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(u, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">hist</span>(norm_sim, <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">""</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(norm_sim), <span class="fu">max</span>(norm_sim), <span class="at">len =</span> <span class="dv">500</span>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lines</span>(x, <span class="fu">dnorm</span>(x, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma))</span></code></pre></div>
<p><img src="stat0002-ch1b-stochastic-simulation-vignette_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<ol start="6" style="list-style-type: decimal">
<li><strong>Use <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">?qnorm</a></code> to find out what <code>qnorm</code>
does.</strong></li>
</ol>
<p>Note that the help page calls this the <em>quantile function</em>. An
alternative name is the <em>inverse cumulative distribution
function</em> or <em>inverse c.d.f</em>.</p>
</div>
<div class="section level2">
<h2 id="more-general-methods-of-simulation">More general methods of simulation<a class="anchor" aria-label="anchor" href="#more-general-methods-of-simulation"></a>
</h2>
<p>Often the most efficient method of simulating values from a
probability distribution is one that has been devised for that
particular distribution. However, it is useful to have more general
methods that can, in principle, be used to simulate from any
distribution, although, in practice, there are constraints on the type
of distribution to which a method can be applied. Many of these methods
work by proposing values and then accepting or rejecting them using a
rule (hence they are often called <em>acceptance-rejection</em> or
<em>rejection</em> methods). See <span class="citation">Morgan
(1984)</span> and <span class="citation">Jasra (2011)</span> for
details. One such method is the <em>generalized ratio-of-uniforms</em>
method (<span class="citation">Wakefield, Gelfand, and Smith
(1991)</span> and references therein), which can be used for univariate
distributions (involving one random variable) and for multivariate
distributions (involving two or more random variables), provided that
the p.d.f. of the distributions satisfies some conditions.</p>
<p>The <em>rust</em> R package <span class="citation">(Northrop
2017)</span> implements this algorithm. The code below can be used to
simulate from a standard normal distribution using the function
<code>ru</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(rust)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="sc">&gt;</span> ?ru</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Simulate from a standard normal N(0,1) distribution</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="er">&gt;</span> ru_sim <span class="ot">&lt;-</span> <span class="fu">ru</span>(<span class="at">logf =</span> <span class="cf">function</span>(x) <span class="sc">-</span>x <span class="sc">^</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>, <span class="at">d =</span> <span class="dv">1</span>, <span class="at">n =</span> <span class="dv">1000</span>, <span class="at">init =</span> <span class="fl">0.1</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># The function ru returns an object of class "ru"</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">class</span>(ru_sim)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"ru"</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># The default plot method for objects of class "ru" produces a plot to compare the </span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># simulated values and the p.d.f. of the distribution from which they are simulated</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">plot</span>(ru_sim, <span class="at">xlab =</span> <span class="st">"x"</span>)</span></code></pre></div>
<p><img src="stat0002-ch1b-stochastic-simulation-vignette_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>Note that</p>
<ul>
<li>the main input to this function is the (natural) log of the p.d.f of
a standard normal distribution, i.e. the log of <span class="math inline">\(\frac{1}{\sqrt{2\pi}} e^{-\frac12
x^2}\)</span>;<br>
</li>
<li>we don’t need to include the normalizing constant <span class="math inline">\(1/\sqrt{2\pi}\)</span>, that is, the constant that
is included to ensure that the p.d.f. integrates to 1 over the support
<span class="math inline">\(-\infty &lt; x &lt; \infty\)</span> of this
distribution.</li>
</ul>
<p>The second point, a typical feature of <em>rejection</em> methods,
can be important because there are cases where we can’t easily calculate
the normalizing constant.</p>
<p>We the use of <code>ru</code> to simulate from a multivariate
distribution using the bivariate normal distribution. This distribution
will be studied in the second-year statistics module STAT0005. See the
Wikipedia page for the <a href="https://en.wikipedia.org/wiki/Multivariate_normal_distribution#Non-degenerate_case" class="external-link">multivariate
normal distribution</a> for the form of the p.d.f. of this distribution.
The function <code>log_dmvnorm</code> below calculates the log of the
p.d.f. of the multivariate normal distribution with mean vector
<code>mean</code> and variance-covariance matrix <code>sigma</code>,
again ignoring the normalizing constant.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># two-dimensional normal with positive association ----------------</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="er">&gt;</span> rho <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="sc">&gt;</span> covmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="sc">&gt;</span> log_dmvnorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">mean =</span> <span class="fu">rep</span>(<span class="dv">0</span>, d), <span class="at">sigma =</span> <span class="fu">diag</span>(d)) {</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="sc">+</span>   x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(x, <span class="at">ncol =</span> <span class="fu">length</span>(x))</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="sc">+</span>   d <span class="ot">&lt;-</span> <span class="fu">ncol</span>(x)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">return</span>(<span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> (x <span class="sc">-</span> mean) <span class="sc">%*%</span> <span class="fu">solve</span>(sigma) <span class="sc">%*%</span> <span class="fu">t</span>(x <span class="sc">-</span> mean))</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="sc">&gt;</span> ru_sim2 <span class="ot">&lt;-</span> <span class="fu">ru</span>(<span class="at">logf =</span> log_dmvnorm, <span class="at">sigma =</span> covmat, <span class="at">d =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">1000</span>, <span class="at">init =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<p>In the bivariate case the <code>plot</code> method for objects of
class “ru” produces a scatter plot of the simulated values of the random
variables <span class="math inline">\((X_1, X_2)\)</span> with the
contours of the value of the p.d.f. superimposed. Each contour is
labelled by a number indicating the percentage of the simulated values
that should lie within that contour.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(ru_sim2, <span class="at">xlab =</span> <span class="fu">expression</span>(X[<span class="dv">1</span>]), <span class="at">ylab =</span> <span class="fu">expression</span>(X[<span class="dv">2</span>]))</span></code></pre></div>
<p><img src="stat0002-ch1b-stochastic-simulation-vignette_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
<p>The generalized ratio-of-uniforms method works well enough for this
example but it is not the most efficient way to simulate from a
multivariate normal distribution. A better function is the
<code>mvrnorm</code> in the MASS package <span class="citation">(Venables and Ripley 2002)</span>. Use
<code><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">library(MASS)</a></code> and <code><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">?mvrnorm</a></code> to find out about
it.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script><div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Jasra" class="csl-entry">
Jasra, A. 2011. <em><span>M3/M4S9</span> Stochastic Simulation (Course
Notes)</em>. Imperial College, London. <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.188.5510&amp;rep=rep1&amp;type=pdf" class="external-link">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.188.5510&amp;rep=rep1&amp;type=pdf</a>.
</div>
<div id="ref-Morgan" class="csl-entry">
Morgan, B. J. T. 1984. <em>Elements of Simulation</em>. Chapman &amp;
Hall. <a href="https://www.crcpress.com/Elements-of-Simulation/Morgan/p/book/9780412245909" class="external-link">https://www.crcpress.com/Elements-of-Simulation/Morgan/p/book/9780412245909</a>.
</div>
<div id="ref-rust" class="csl-entry">
Northrop, P. J. 2017. <em>Rust: Ratio-of-Uniforms Simulation with
Transformation</em>. <a href="https://CRAN.R-project.org/package=rust" class="external-link">https://CRAN.R-project.org/package=rust</a>.
</div>
<div id="ref-MASS" class="csl-entry">
Venables, W. N., and B. D. Ripley. 2002. <em>Modern Applied Statistics
with s</em>. Fourth. New York: Springer. <a href="http://www.stats.ox.ac.uk/pub/MASS4" class="external-link">http://www.stats.ox.ac.uk/pub/MASS4</a>.
</div>
<div id="ref-WGS1991" class="csl-entry">
Wakefield, J. C., A. E. Gelfand, and A. F. M. Smith. 1991.
<span>“Efficient Generation of Random Variates via the Ratio-of-Uniforms
Method.”</span> <em>Statistics and Computing</em> 1 (2): 129–33. <a href="https://doi.org/10.1007/BF01889987" class="external-link">https://doi.org/10.1007/BF01889987</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul J. Northrop.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
